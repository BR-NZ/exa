# Webpack
Сам браузер не умеет обрабатывать модули js-файлов, ни из Modules ES6, ни из CommonJS, поэтому для сборки применяют дополнительные инструменты.  

__webpack__ – сборщик модулей, который компилирует различные js-модули в единый js-файл в правильном порядке. При запуске он обрабатывает модули, строит между ними граф зависимостей, и на основе графа генерирует единый файл JS, CSS и тд. Работает с языками JS, CoffeeScript, TS, а также на бекенде с Node.js.

__Среди прочих функций:__ транспиляция синтаксиса в конечный «чистый» JS и CSS, оптимизация изображений и других файлов, адаптация кода под старые браузеры, минимизация кода, решение конфликтов, включение CSS в JS.
* `Entry (точка входа)` – файл, с которого сборщик начнет объединять модули, обычно это основной js-файл проекта, от которого зависят остальные. В конфиге можно настроить несколько входных точек.
* `Output (точка выхода)` – файл «бандл», в который запишется готовый проект, при настройке для него нужно указать путь. В конфиге можно настроить несколько точек выхода, например, чтобы не загружать сеть одним большим файлом.
* `Loaders (загрузчики)` – дополнения для преобразованию форматов файлов, которые мы импортируем в JS. Они принимают содержимое файлов, затем включают результат преобразования в общую сборку. Например, изначально поддерживаются файлы JSON и JS. С помощью загрузчков можно научить сборщик понимать другие файлы (SASS, CSS, TYPESCRIPT, SVG, IMG). Устанавливаются отдельно. (Babel это загрузчик)
* `Plugins (плагины)` – второй вид дополнительных сущностей как надстройки для дополнительных задач, например автоматического создания HTML-файла, к которому подключается бандл. Устанавливаются отдельно.

__Режимы:__ настройки для конкретных задач
1.	`Production` – для финальной сборки перед выгрузкой на сервер. Дает максимальную оптимизацию ресурсов, делает код сжатым, но нечитаемым.
2.	`Development` – для тестовых сборок, которые нужны в разработке, несильно сжимает код, оставляет читаемым. Может привязать карты исходников.
3.	`None (по умолчанию)` – отключает настройки оптимизации проекта.

<br>

## Установка:
1.	В терминале папки проекта запускаем: 
```
npm i -g webpack webpack-cli //глобальная установка
npm i webpack webpack-cli –save-dev //локальная установка
npm i -D raw-loader –save-dev //локальная установка загрузчика
```

2.	После в файл `package.json` указываем команду-триггер для запуска сборки:
```javascript
//создаем скрипты команд вызова
“scripts”: { 
“build”: “webpack”
“build:dev”: “webpack --config webpack.dev.js”,
“build:prod”: “webpack --config webpack.prod.js”
}
```

3.	В корне создаем _файл кофигурации_ `webpack.config.js`. 

4.	В терминале запускаем сборщик по команде:
```
npx webpack //прямой вызов
npm [rum] build //вызов по триггеру созданному ранее
// CTRL + C (остановить сервер webpack в консоли)
```

__ПО ДЕФОЛТУ:__  
* Все исходные файл до сборки должны храниться в папке `src`, там же файл `index.js` – точка входа
* Результирующий файл `main.js` будет лежать в папке `dist`
* Режим работы «продакшен»

<br>

## Файл конфигурации:
Как правило, он один – `webpack.config.js`, который по сути сам получает от нас сконфигурированный объект с настройками и экспортирует его.  
Иногда разбивают на два файла конфигурации: для продакшена `webpack.dev.js` и разработки `webpack.prod.js`. 
```javascript
// Импортируем модуль для работ с путями
const path = require('path');

// У самого Webpack уже есть встроенные плагины
const webpack = require('webpack');

module.exports = {
	// Указываем входную точку
	entry: './path/to/index.js',

	// Нужна карта исходников
	devtool: 'source-map',
	// Указываем режим работы
	mode: 'development',
	// Заставляет отслеживать изменения в файлах и пересобирать
	watch: true,

	// Будем использовать лоадер для определения файлов
	module: {
		// Указываем правила для данных модулей
		rules: [
			// test (путь в формате регулярки), use (название лоадера)
			{ test: /.txt$/, use: 'raw-loader' },
		]
	},
	plugins: [
		// Указываем что будем обрабатывать HTML с помощью плагина
		new HtmlWebpackPlugin({ template: './src/index.html' }),
	], 
	// Указываем точку выхода
	output: {
		// Полный путь к папке, где будет храниться конечный файл
		// __dirname – это адрес папки самого проекта
		path: path.resolve(__dirname, 'dist'),
		// Указываем имя этого файла
		filename: 'my-first-webpack.bundle.js',
	},
};
```

<br>

## DevServer
Можно установить дополнительный модуль webpack-dev-server – с ним проект будет пересобираться в реальном времени и обновлять браузер при каждом изменении кода.  
```
npm i webpack-dev-server //локальная установка сервера
```
В конфиг добавляем следующее:  
```javascript
// Конфигурация для встроенного сервера
devServer: {
	// Указывается вся статика, которая будет на нашем сервере
	static: {
	directory: path.join(__dirname, 'public'),
	},
	// Сжимать ли бандл при компиляции
	compress: true,
	// Порт на котором будет наш сервер
	port: 9000,

	client: {
		// Показывает ошибки при компиляции в самом браузере
		overlay: {
			// Ошибки
			errors: true,
			// Предупреждения
			warnings: false,
		},
		// Показывает прогесс компиляции
		progress: true
  	},
}
```
