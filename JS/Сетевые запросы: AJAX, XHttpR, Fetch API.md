# AJAX, XHttpR, Fetch API

__`AJAX (Async Javascript And Xml)`__ – подход и методика по асинхронной динамической подгрузке данных, не приводящей к перезагрузке страницы.

Такие запросы производятся через стандартные методы (включенные в язык): XMLHttpRequest, Fetch API. А также дополнительные методы (из библиотек): Axios и пр.

## Подходящие для HTTP-post запросов заголовки `headers`:
```javascript
// JSON:
‘Content-type’ : ‘application/json’
// FormData:
‘Content-type’ : ‘multipart/form-data’ (его не указывать, он ставится сам)
// Text:
‘Content-type’ : ‘text/plain’
// IMG:
‘Content-type’ : ‘’
// Опционально: добавить ко всем ‘charset=UTF-8’
```

<br>

## XMLHttpRequest
__`XMLHttpRequest`__ – изначально был разработан Microsoft, но позже заимствован Mozilla, Apple, и Google. Сейчас он входит в станарт и несмотря на своё название, может быть использован для получения любых типов данных, не только `XML`, и поддерживает не только `HTTP-протокол,` но и `FILE` и `FTP`. 

```javascript
// 0. С помощью спец-класса создаем объект запроса
let myRequest = new XMLHttpRequest();

// 1. Метод для настройки будущего запроса
myRequest.open(
  ‘METHOD’ – GET, POST.., 
  ‘URL’ – адрес к файлу относительно html-страницы,
  ASYNC* – флаг вкл/выкл асинхронность запроса (опционально),
  LOGIN*, PASS* – при запросах по доступу (опционально)
);

// 2. Запись заголовка Http-запроса (какого типа данные ожидаем):
myRequest.setRequestHeader( ‘Content-type’, ‘тип-данных’ );

// 3. Отправляем тело запроса – для POST методов, 
// для GET методов – ничего (сам запрос этим методом асинхронен, то есть может через время прийти ответ)
myRequest.send( BODY (если POST) / ничего (если GET) );

// 4. После отправки запроса, можно повешать слушателя его состояния
myRequest.addEventListener(' load ', () => {
  // 5. В обработчике можем работать с готовым объектом запроса
})
```

<br>

### Среди интересных событий:
* `readystatechange` – отслеживает факт изменения стадии готовности запроса, а именно свойства readyState;
* `load` – срабатывает при значении свойства readyState = 4;

### Объект запроса XMLHttpRequest сожержит полезные свойства, получаемые при его исполнении:
* `.status` – числовое представление ответа сервера, до выполнения = 0;
* `2хх` - все ок, `3хх` - редирект, `4хх` - ошибка клиента, `5хх` - ошибка сервера;
* `.statusText` – словесное представление ответа сервера с описанием;
* `.readyState` – числовое представление этапа готовности запроса от 0 до 4;
* `.response` – сам ответ сервера, то что в body теле ответа;

| Значение  | Состояние (readyState) | Состояние |
|-----------|------------------------|-----------|
| 0 | UNSENT | Объект был создан. Метод `open()` ещё не вызывался. |
| 1 | OPENED | Метод `open()` был вызван |
| 2 | HEADERS_RECEIVED | Метод `send()` был вызван, доступны заголовки (headers) и статус. |
| 3 | LOADING | Загрузка; responseText содержит частичные данные. |
| 4 | DONE | Операция полностью завершена. |
